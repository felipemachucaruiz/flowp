Paso 1: Obtener el Token de AutenticaciÃ³n
Primero, necesitas autenticarte en la API:
Solicitud
curl -X POST https://api-v2.matias-api.com/api/ubl2.1/auth/login \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "client_id=YOUR_CLIENT_ID" \
  -d "client_secret=YOUR_CLIENT_SECRET" \
  -d "grant_type=client_credentials"

Respuesta
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "Bearer",
  "expires_in": 3600
}

INFO
Guarda esteÂ access_token, lo usarÃ¡s en todos los prÃ³ximos pasos.
Paso 2: Preparar los Datos de la Factura
ReÃºne la informaciÃ³n necesaria:
ğŸ“ InformaciÃ³n del Documento
{
  "resolution_number": "18764074347312",
  "prefix": "LZT",
  "document_number": "2002",
  "date": "2024-10-17",
  "time": "14:30:00"
}

ğŸ“ InformaciÃ³n del Cliente (Comprador)
{
  "country_id": "45",
  "city_id": "836",
  "identity_document_id": "1",
  "type_organization_id": 2,
  "tax_regime_id": 2,
  "tax_level_id": 5,
  "company_name": "LOPEZ GOMEZ LEWIS OSWALDO",
  "dni": "1063279307",
  "email": "lws_1234@hotmail.com",
  "address": "Calle 64 #1823",
  "postal_code": "661002"
}

INFO
Nota Importante:Â El emisor (tu empresa) NO se envÃ­a en el JSON. La API identifica al emisor por elÂ token de autenticaciÃ³n. Solo debes enviar informaciÃ³n del cliente (comprador).
Paso 3: Crear la Estructura JSON de la Factura
Monta el JSON completo usando la estructura real del API:
{
  "resolution_number": "18764074347312",
  "prefix": "LZT",
  "notes": "Nota del documento",
  "document_number": "2002",
  "graphic_representation": 0,
  "send_email": 1,
  "operation_type_id": 1,
  "type_document_id": 7,
  
  "payments": [
    {
      "payment_method_id": 1,
      "means_payment_id": 10,
      "value_paid": "224.00"
    }
  ],
  
  "customer": {
    "country_id": "45",
    "city_id": "836",
    "identity_document_id": "1",
    "type_organization_id": 2,
    "tax_regime_id": 2,
    "tax_level_id": 5,
    "company_name": "LOPEZ GOMEZ LEWIS OSWALDO",
    "dni": "1063279307",
    "mobile": "3108435423",
    "email": "lws_1234@hotmail.com",
    "address": "Calle 64 #1823",
    "postal_code": "661002"
  },
  
  "lines": [
    {
      "invoiced_quantity": "2",
      "quantity_units_id": "1093",
      "line_extension_amount": "100.00",
      "free_of_charge_indicator": false,
      "description": "TIJERA NECROPSIA AVES",
      "code": "HMT83",
      "type_item_identifications_id": "4",
      "reference_price_id": "1",
      "price_amount": "50",
      "base_quantity": "2",
      "tax_totals": [
        {
          "tax_id": "1",
          "tax_amount": 19,
          "taxable_amount": 100,
          "percent": 19
        }
      ]
    }
  ],
  
  "legal_monetary_totals": {
    "line_extension_amount": "100.00",
    "tax_exclusive_amount": "100.00",
    "tax_inclusive_amount": "119.00",
    "payable_amount": 119.00
  },
  
  "tax_totals": [
    {
      "tax_id": "1",
      "tax_amount": 19,
      "taxable_amount": 100,
      "percent": 19
    }
  ]
}

AVISO
Puntos Importantes:
* type_document_id: 7Â â†’ Factura de venta
* operation_type_id: 1Â â†’ EstÃ¡ndar
* line_extension_amountÂ =Â invoiced_quantityÂ Ã—Â price_amount
* tax_inclusive_amountÂ =Â tax_exclusive_amountÂ + suma deÂ tax_totals.tax_amount
* ElÂ customer.dniÂ NO incluye dÃ­gito verificador en este caso
Paso 4: Validar la Factura Localmente
Antes de enviarla a la API, verifica:
âœ…Â IdentificaciÃ³n
* resolution_number: "18764074347312"Â (vÃ¡lida)
* prefix: "LZT"Â (registrada en DIAN)
* document_number: "2002"Â (no duplicado)
* type_document_id: 7Â (Factura de venta)
* operation_type_id: 1Â (OperaciÃ³n estÃ¡ndar)
âœ…Â Cliente
* dni: "1063279307"Â (vÃ¡lido con dÃ­gito verificador)
* company_name: "LOPEZ GOMEZ LEWIS OSWALDO"Â (no vacÃ­o)
* email: "lws_1234@hotmail.com"Â (formato correcto)
* country_id: "45"Â (Colombia)
âœ…Â LÃ­neas
* invoiced_quantity: "2"Â > 0
* price_amount: "50"Â > 0
* line_extension_amount: "100.00"Â = 2 Ã— 50 âœ“
* tax_totalsÂ con cÃ¡lculo: 100 Ã— 0.19 = 19 âœ“
âœ…Â Totales
* tax_exclusive_amount: "100.00"Â = suma de lÃ­neas
* tax_inclusive_amount: "119.00"Â = 100 + 19 âœ“
* payable_amount: 119.00Â =Â tax_inclusive_amountÂ âœ“
âœ…Â Pagos
* value_paid: "224.00"Â =Â payable_amountÂ âœ“
* payment_method_id: 1Â (vÃ¡lido)
* means_payment_id: 10Â (vÃ¡lido)
Paso 5: Enviar la Factura a la API
Una vez validada localmente, envÃ­a la factura:
curl -X POST https://api.matias-app.com/api/invoices \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
  "resolution_number": "18764074347312",
  "prefix": "LZT",
  "notes": "Nota del documento",
  "document_number": "2002",
  "type_document_id": 7,
  "operation_type_id": 1,
  "graphic_representation": 0,
  "send_email": 1,
  "customer": {
    "country_id": "45",
    "city_id": "836",
    "identity_document_id": "1",
    "type_organization_id": 2,
    "tax_regime_id": 2,
    "tax_level_id": 5,
    "company_name": "LOPEZ GOMEZ LEWIS OSWALDO",
    "dni": "1063279307",
    "mobile": "3108435423",
    "email": "lws_1234@hotmail.com",
    "address": "Calle 64 #1823",
    "postal_code": "661002"
  },
  "lines": [
    {
      "invoiced_quantity": "2",
      "quantity_units_id": "1093",
      "line_extension_amount": "100.00",
      "free_of_charge_indicator": false,
      "description": "TIJERA NECROPSIA AVES",
      "code": "HMT83",
      "type_item_identifications_id": "4",
      "reference_price_id": "1",
      "price_amount": "50",
      "base_quantity": "2",
      "tax_totals": [
        {
          "tax_id": "1",
          "tax_amount": 19,
          "taxable_amount": 100,
          "percent": 19
        }
      ]
    }
  ],
  "legal_monetary_totals": {
    "line_extension_amount": "100.00",
    "tax_exclusive_amount": "100.00",
    "tax_inclusive_amount": "119.00",
    "payable_amount": 119.00
  },
  "tax_totals": [
    {
      "tax_id": "1",
      "tax_amount": 19,
      "taxable_amount": 100,
      "percent": 19
    }
  ],
  "payments": [
    {
      "payment_method_id": 1,
      "means_payment_id": 10,
      "value_paid": "119.00"
    }
  ]
}'

Respuesta Exitosa
{
  "message": "El documento ha sido procesado por la DIAN.",
  "send_to_queue": 0,
  "XmlDocumentKey": "d45f3b2ed042ce0e075891591c3b3a7ae3a9c176ca191dab1bd23e5cdd3b48b8c548a088dfcbe20ee7baa2bed2dccd48",
  "response": {
    "ErrorMessage": {
      "string": []
    },
    "IsValid": "true",
    "StatusCode": "00",
    "StatusDescription": "Procesado Correctamente.",
    "StatusMessage": "La Factura electrÃ³nica LZT2002, ha sido autorizada.",
    "XmlBase64Bytes": "",
    "XmlBytes": {
      "_attributes": {
        "nil": "true"
      }
    },
    "XmlDocumentKey": "d45f3b2ed042ce0e075891591c3b3a7ae3a9c176ca191dab1bd23e5cdd3b48b8c548a088dfcbe20ee7baa2bed2dccd48",
    "XmlFileName": "fv09010914030002500000095"
  },
  "XmlBase64Bytes": "",
  "AttachedDocument": {
    "pathZip": "1/ad/z09010914030002500000042.zip",
    "path": "1/ad/ad09010914030002500000041.xml",
    "url": "https://api-v2.matias-api.com/attachments/1/ad/ad09010914030002500000041.xml",
    "data": ""
  },
  "qr": {
    "qrDian": "",
    "url": "",
    "path": "1/fv09010914030002500000095.png",
    "data": ""
  },
  "pdf": {
    "path": "1/fv09010914030002500000095.pdf",
    "url": "https://api-v2.matias-api.com/pdf/1/fv09010914030002500000095.pdf",
    "data": ""
  },
  "success": true
}


INFO
Campos Clave en la Respuesta:
* message: Mensaje genÃ©rico del API
* XmlDocumentKeyÂ (CUFE): Identificador Ãºnico del documento en DIAN
* response.IsValid: "true" = documento vÃ¡lido
* response.StatusCode: "00" = procesado correctamente
* response.StatusMessage: ConfirmaciÃ³n de autorizaciÃ³n
* XmlFileName: Nombre del documento en portal DIAN
* success: true = operaciÃ³n exitosa
* pdf.url: Enlace para descargar el PDF
* AttachedDocument.url: Enlace del XML
Si Hay Errores
{
  "success": false,
  "message": "El documento (Factura electrÃ³nica) con numero LZT2002, ya se encuentra validado"
}


AVISO
CÃ³digos de Error Comunes:
* Documento duplicado
* Datos de cliente invÃ¡lidos
* CÃ¡lculos de totales incorrectos
* NIT sin dÃ­gito verificador o incorrecto
* ResoluciÃ³n no vÃ¡lida o vencida
Paso 6: Consultar Detalles del Documento
Para obtener los detalles completos de tu factura despuÃ©s de haberla creado:
curl -X GET "https://api.matias-app.com/api/invoices/LZT-2002" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"

Respuesta
{
  "message": "El documento ha sido procesado por la DIAN.",
  "send_to_queue": 0,
  "XmlDocumentKey": "d45f3b2ed042ce0e075891591c3b3a7ae3a9c176ca191dab1bd23e5cdd3b48b8c548a088dfcbe20ee7baa2bed2dccd48",
  "response": {
    "ErrorMessage": {
      "string": []
    },
    "IsValid": "true",
    "StatusCode": "00",
    "StatusDescription": "Procesado Correctamente.",
    "StatusMessage": "La Factura electrÃ³nica LZT2002, ha sido autorizada.",
    "XmlBase64Bytes": "",
    "XmlBytes": {
      "_attributes": {
        "nil": "true"
      }
    },
    "XmlDocumentKey": "d45f3b2ed042ce0e075891591c3b3a7ae3a9c176ca191dab1bd23e5cdd3b48b8c548a088dfcbe20ee7baa2bed2dccd48",
    "XmlFileName": "fv09010914030002500000095"
  },
  "XmlBase64Bytes": "",
  "AttachedDocument": {
    "pathZip": "1/ad/z09010914030002500000042.zip",
    "path": "1/ad/ad09010914030002500000041.xml",
    "url": "https://api-v2.matias-api.com/attachments/1/ad/ad09010914030002500000041.xml",
    "data": ""
  },
  "qr": {
    "qrDian": "",
    "url": "",
    "path": "1/fv09010914030002500000095.png",
    "data": ""
  },
  "pdf": {
    "path": "1/fv09010914030002500000095.pdf",
    "url": "https://api-v2.matias-api.com/pdf/1/fv09010914030002500000095.pdf",
    "data": ""
  },
  "success": true
}


SUCCESS
Â¡Tu factura estÃ¡ lista!
Con los datos de la respuesta puedes:
* ğŸ“¥Â Descargar el PDF: UsaÂ pdf.url
* ğŸ“„Â Obtener el XML: UsaÂ AttachedDocument.url
* ğŸ“±Â Compartir el QR: UsaÂ qr.url
* âœ…Â Verificar: El CUFE (XmlDocumentKey) es Ãºnico e irrepetible
Tiempo estimado de validaciÃ³n DIAN: 30 minutos a 2 horas
Paso 7: Enviar Comprobante al Cliente
Si configurasteÂ send_email: 1, la API enviarÃ¡ automÃ¡ticamente. Para enviar nuevamente:
curl -X POST https://api.matias-app.com/api/invoices/12345/send-email \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "compras@cliente.com"
  }'

Checklist de Ã‰xito
* 		Â JSON coincide con estructura del API
* 		Â Todos los campos requeridos presentes
* 		Â CÃ¡lculos de totales e impuestos correctos
* 		Â NIT del cliente vÃ¡lido
* 		Â Respuesta HTTP 200 o 201
* 		Â status_id: 1Â o superior en respuesta
* 		Â CUFE generado correctamente
* 		Â Cliente recibiÃ³ email
Troubleshooting
âŒ "invalid_json"
Causa: JSON malformado o campos extrasâ€¨SoluciÃ³n: Usa la estructura exacta del ejemplo. Revisa la documentaciÃ³n de campos obligatorios.
âŒ "NIT verificador invÃ¡lido"
Causa: El dÃ­gito verificador del NIT es incorrectoâ€¨SoluciÃ³n: Usa el validador NITValidator en herramientas interactivas
âŒ "Duplicate document"
Causa: Ya existe una factura con el mismoÂ prefixÂ yÂ document_numberâ€¨SoluciÃ³n: Incrementa elÂ document_numberÂ o usa diferenteÂ prefix
âŒ "tax_amount calculation error"
Causa: Los impuestos no se calculan correctamenteâ€¨SoluciÃ³n:Â tax_amountÂ =Â taxable_amountÂ Ã— (percentÂ / 100)
